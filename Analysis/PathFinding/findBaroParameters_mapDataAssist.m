clear all; clc; clf;

%% File set to process:
baro_files = {
    %'baro_n501_20141201_230214', 1417573441, NaN;  % fail on butter()
    %'baro_n501_20141203_085057', NaN, 1417628515;   % suffer by highway
    %'baro_n501_20141213_093710', NaN, 1418494703;  % fail on butter()
    %'baro_n501_20141215_212237', 1418717289, NaN;  % fail on butter()
    %'baro_n501_20150108_221546', NaN, NaN;  % suffer by highway
    %'baro_n503_20150110_143636', 1420929573, 1420931703, 101, 2;
    %'baro_n503_20150110_155834', NaN, NaN, 101, 4;
    %'baro_n503_20150110_161641', NaN, NaN, NaN, NaN;
    %'baro_n503_20150111_091333', NaN, NaN, NaN, NaN  % not that clean, so break down, if have time, there's brill hill, too.
    %'baro_n503_20150111_091333', 1420997164, 1421000350, 23, 6  % Los Angeles   % run for long time... I've save the result, try to grab that
    'baro_n503_20150111_091333', 1421001984, 1421003596, 101, 2  % not that clean %too many ucla data....
};

baro_files(:,1) = strcat('../../Data/rawData/',baro_files(:,1));
baro_files(:,1) = strcat(baro_files(:,1),'.gps.csv');
limits = cell(length(baro_files),2); [limits{:}] = deal(NaN);


%% Function, can't think of a name right now

calWin = 60*10;    % in seconds


totalErrors = [];
totalSummary = [];

for file=1:size(baro_files, 1);
    % Create SensorData for file, parse elevation and barometer
    sensorFile = baro_files{file,1};
    startTime = baro_files{file,2};
    stopTime = baro_files{file,3};
    sData = SensorData(sensorFile);
    sData.setWindowSize(1);

    if ~(isnan(startTime) && isnan(stopTime))
       if isnan(startTime)
           startTime = min(sData.raw_gps(:,1));
       end
       if isnan(stopTime)
           stopTime = max(sData.raw_gps(:,1));
       end
       sData.setAbsoluteSegment(startTime, stopTime);
    end
    
    gpsEle = sData.getGps2Ele();
    
    gpsEleFromMap = gpsEle;  % default value, see if we can be assisted from map
    if ~isnan(baro_files{file,4})
        mapManager = MapManager('../../Data/EleSegmentSets/');
        mapData = mapManager.getMapDataObject(baro_files{file,4}, baro_files{file,5}, 1);

        % not use gpsEle. Instead, based on the gps coordinate, query the
        % elevation of closest points on the map.
        fprintf('calculating the aligned gps.... very time consuming....');
        alignedGps = mapData.rawGpsAlignment(gpsEle(:, 2:3));
        fprintf('done\n');

        %clf
        %hold on
        %plot(gpsEle(:,3), gpsEle(:,2), 'b');
        %plot(alignedGps(:,2), alignedGps(:,1), 'r');

        gpsEleFromMap = [floor(gpsEle(:,1)) alignedGps];
        gpsEleFromMap = gpsEleFromMap(gpsEleFromMap(:,5) <= 10, :);
        gpsEleFromMap = gpsEleFromMap(:,1:4);
    end
    
    % don't consider the stopping case
    latShift1 = ( gpsEleFromMap(1:end-2, 2) == gpsEleFromMap(2:end-1, 2) );
    latShift2 = ( gpsEleFromMap(1:end-2, 2) == gpsEleFromMap(3:end  , 2) );
    lngShift1 = ( gpsEleFromMap(1:end-2, 3) == gpsEleFromMap(2:end-1, 3) );
    lngShift2 = ( gpsEleFromMap(1:end-2, 3) == gpsEleFromMap(3:end  , 3) );
    idx = [ ~(latShift1 & latShift2 & lngShift1 & lngShift2) ; true(2, 1)];
    gpsEleFromMap = gpsEleFromMap(idx, :);
    
    eleWin = sData.getElevationTimeWindow();
    % Filter intervals with no data points
    baroWin = [floor(eleWin(:,1)), eleWin(:,2)/sData.PRESSURE_M2HPA + sData.PRESSURE_SEALEVEL];
    [~,iab] = setdiff(gpsEleFromMap(:,1), baroWin(:,1));
    [~,iag] = setdiff(baroWin(:,1), gpsEleFromMap(:,1));
    gpsEleFromMap = removerows(gpsEleFromMap, iab);
    baroWin = removerows(baroWin, iag);
    if isempty(gpsEle) || isempty(eleWin)
        disp('Empty set, ignoring.');
        continue
    end
    % Append extra values to allow reshape
    mBaros = baroWin(:,2);
    oElevs = gpsEleFromMap(:,4);
    short = calWin - mod(length(mBaros), calWin);
    if short ~= calWin
        mBaros = [mBaros; nan(short, 1)];
        oElevs = [oElevs; nan(short, 1)];
    end
    winCount = length(mBaros)/calWin;
    mBaros = reshape(mBaros, calWin, winCount)';
    oElevs = reshape(oElevs, calWin, winCount)';
    rmsErrs = zeros(1, winCount);
    params = zeros(winCount, 2);
    rowLength  = zeros(winCount, 1);
    elepred = zeros(1, length(baroWin(:,1)));
    
    for win = 1:winCount
        baroSet = mBaros(win,:)'; elevSet = oElevs(win,:)';
        baroSet(isnan(baroSet)) = []; elevSet(isnan(elevSet)) = [];
        Z = [baroSet ones(length(baroSet),1)];
        R = pinv(Z)*elevSet;
        S = Z*R;
        
        params(win,:) = R;
        lBound = calWin*(win-1)+1;
        elepred(lBound:lBound+length(baroSet)-1) = S;
        
        delta = S - elevSet;
        rmsErrs(win) = sqrt(mean(delta.^2));
        totalErrors = [totalErrors; delta];
        rowLength(win) = length(baroSet);
    end
    disp(rmsErrs);
    fullPred = [baroWin(:,1) elepred'];
    figure;
    plot(gpsEleFromMap(:,1),gpsEleFromMap(:,4),fullPred(:,1),fullPred(:,2),'r','LineWidth',0.75);
    id = str2num(baro_files{file,1}(end-13:end-8));
    blockSummary = [id * ones(winCount, 1)   rowLength   params];
    totalSummary = [totalSummary; blockSummary];
    
    % Print or store as necessary here, available variables:
    %   rmsErrs: root-mean-square error for each window in set.
    %   fullPred: predicted height using barometer data.
    %   params: scale+offset parameters that satisfy:
    %        height = params(X, 1)*baro + params(X, 2)
    %        Where X is index of window on which pseudo-inverse was
    %        computed. 'params' contains one set for each window.
    
end

%%
save('gpsEleFromMap', 'gpsEleFromMap');
save('fullPred', 'fullPred');
return
%% just for debug
idx = (1400 < gpsEleFromMap(:,1) & gpsEleFromMap(:,1) < 1650);
figure
subplot(2, 1, 1)
plot(gpsEleFromMap(idx, 3), gpsEleFromMap(idx, 2), '-o')
subplot(2, 1, 2)
plot(gpsEleFromMap(idx,1),gpsEleFromMap(idx,4),fullPred(idx,1),fullPred(idx,2),'r','LineWidth',0.75);

%% save the data
rootDir = '../../Data/tmpMatFiles/baroParameter/';
save([rootDir 'totalErrors'], 'totalErrors');
save([rootDir 'totalSummary'], 'totalSummary');

%% load the data
rootDir = '../../Data/tmpMatFiles/baroParameter/';
load([rootDir 'totalErrors'], 'totalErrors');
load([rootDir 'totalSummary'], 'totalSummary');

%% result for 'baro_n503_20150111_091333', 1420997164, 1421000350, 23, 6

deltaError = [
1.30041929528296
          1.10392150182224
         0.758865629151948
         0.543438376327309
         0.575869868074378
         0.400454363153834
         0.332436387916289
         0.313720709638567
         0.354821499069921
         0.533740956417368
         0.555576322901103
         0.282892272304004
         0.330181335255325
         0.509159449685775
         0.375027253007815
         0.028354582678574
        -0.203985731101277
        -0.059721200877604
         -0.26323801280153
        -0.503987536627172
        -0.303950281585017
        -0.300449854354625
        -0.597747479185969
        -0.475369191525672
        -0.171649980177513
        0.0560498964562655
         0.170781851178376
         0.211081896857408
         0.255621777327207
         0.447609634923836
         0.570013808654174
         0.538839663825783
           0.3197566120744
         0.423854148125812
         0.395354999985159
         0.284486623014715
         0.407553465465149
         0.368152731509724
         0.761125109197309
          1.07936443606523
         0.822852123609934
         0.308676417092897
         0.357244046457573
         0.143689793908138
         0.360270526917027
         0.402333318121748
         0.547721056920579
          0.64322249727779
         0.692034704454727
         0.787702024294234
         0.694706507249705
         0.652149643696887
         0.585947196701078
         0.293219646975182
         0.422688935605599
         0.160454276072429
       -0.0564107732604953
        -0.306045602556601
        -0.184836547401019
        -0.317666795939104
        -0.556344988032158
        -0.838549875986189
        -0.569338546914558
        -0.549233735092066
        -0.390590448087814
        -0.230268411324495
        -0.119213210322144
         0.112470488598142
         0.370953152815765
         0.454359405806009
         0.596421163740814
         0.385097024824347
        0.0832593040736072
        -0.219524922063307
       -0.0167076682823009
       -0.0180921742287126
        0.0643548410858585
        0.0161544459177492
         0.240378336377766
         0.576756962159784
         0.649253763387001
         0.781602926382668
         0.815107284601112
         0.727554016233043
         0.494435978798649
         0.229833891454881
          1.48754304902921
         0.930666988556311
         0.348403824466999
         0.338415862279675
         0.388120194119793
         0.303558358423835
         0.321577808451678
         0.449902306287967
         0.458319815816424
         0.377452262768145
         0.301978849607451
         0.224227462395767
         0.393108743214661
         0.351309468717488
         0.321222125063237
          0.52860707882256
         0.527388325140706
         0.506837766766239
         0.368929785115796
       -0.0346574083384681
         0.230400733343778
          0.23940467927266
         0.222932742928478
         0.167164956394622
         0.120109786118235
        0.0519893530314093
        0.0655183279554947
       -0.0607931070031142
         -0.24391846699212
        -0.567087354051395
        -0.676730546998911
        -0.720020129507716
        -0.808130252424199
        -0.632796618687223
        -0.535189939640929
        -0.530616111406303
        -0.781086234152568
        -0.929867096344033
        -0.844574370662095
        -0.336591029959941
        -0.245840857858688
       -0.0580571339701521
        0.0628655932618756
        0.0184368115273301
       0.00627970961038216
        -0.244237548905303
        -0.276297346445936
        -0.335087511614255
        -0.352138539541336
        -0.460925880797987
         -0.55271374012132
        -0.761369467853179
        -0.831917906041596
        -0.920838750985965
        -0.846217920896876
        -0.732673327022248
        -0.738258465475418
         -0.29650183788187
        -0.257740222743514
        -0.194583382923021
        -0.178509642062018
        0.0665619027792488
         0.103104645243121
        0.0567024707488457
         0.242374241428443
         0.387774472090257
         0.460844432936049
         0.425040020835269
        0.0322319760628318
       -0.0586472479926385
         -0.16411924368532
        -0.106977861214418
       -0.0560769031642536
       -0.0885886300737084
        -0.129233761925938
        -0.287702552379578
        -0.422710654608778
        -0.606257352794358
        -0.699954133867614
        -0.607300719454209
        -0.705706861658321
        -0.807332673470242
        -0.880398073437405
        -0.883396105203893
        -0.901672721290844
         -1.19861695394083
         -1.09273020280251
      -0.00588672420308711
         0.107650923818433
         0.372727290384752
         0.452601660139052
          0.40844663603967
         0.749415576759986
         0.486452322279952
         0.633621257555156
         0.682443308271772
         0.705005277043604
         0.905129662898283
          1.08968073234588
           1.2436817239922
          1.11322450023447
         0.836094501896625
         0.691996520315719
         0.596925389785689
         0.406733228822489
         0.347038057958137
         0.107197265498989
         0.136490931086293
        0.0268422791794904
         0.148072828277627
         0.111676959945079
        0.0235696971313075
         0.271324377295684
         0.373077657839978
         0.529496576464176
         0.624550439701373
         0.566314547693764
         0.375331708528449
         0.330437595900889
          0.33520250057957
         0.404495865967867
         0.518103805852803
         0.646631425351117
          0.65146600375769
         0.582843932244963
          0.22696222950632
        0.0828481162252004
         0.293999889217353
         0.459005082081568
         0.451880358939256
         0.607321533535874
         0.434762315841866
         0.411793182999617
         0.153768890901638
         0.159694294689999
         0.434105875737792
         0.380260770127464
         0.274710318864265
         0.315079563146178
         0.365456910582317
        0.0597185335047072
         0.029093638994496
         0.489662602474837
         0.135915437872669
        -0.328220028149119
        -0.614851048416149
        -0.721077521618206
        -0.612439857922524
        -0.704105657260371
        -0.604809882560076
        -0.319271015350104
         0.113532909533525
         0.219699070748312
         0.313621660071973
         0.493763050433479
         0.446052703066954
         0.611044855290771
         0.724958196756617
         0.535524326370236
         0.313012232980356
         0.187437085016853
         0.101788282508053
         0.149282846157675
         0.200892269342162
         0.340686702621674
         0.359857317214534
         0.098384931232907
        0.0581856050637271
         0.165464883910587
         0.089467804972557
         0.328863032426852
         0.264433658101339
         0.407899990356221
         0.398330455195939
         0.309378998912713
         0.145765355146111
       -0.0921723115324085
        -0.193367393358002
        -0.586333236130208
        -0.717081549359769
        -0.756679059683066
         0.364091848831322
         0.295611971203925
         0.261396984419548
         0.407621016770349
         0.275514659677398
         0.251553629695366
         0.178759300680206
         0.252246065209867
         0.281278917411235
         0.257426059828184
       -0.0626355020107496
        -0.385042759368304
        -0.534703820715087
        -0.764419981222005
        -0.927046887882085
        -0.304393776322193
        -0.340605571104696
       -0.0429368506618317
       -0.0371712778148918
        -0.106959713729189
        -0.573418346249298
        -0.597814517644167
        -0.243692803047651
         0.284166626666575
           0.3974529381032
         0.469653027386741
         0.458028959180353
         0.461042249745191
         0.359418986769299
         0.230434773311714
         0.272604060316823
       -0.0207625792806851
        0.0267829200396932
         0.010270928395002
       0.00557584012642565
          -0.1419864009832
        -0.261960946716059
         -0.53666351466569
        -0.612140064436048
        -0.508765474086772
        -0.393662243773306
        -0.179678156943865
        0.0732726168956503
         0.181889632798615
         0.295472858966804
         0.395781187329547
         0.489145719330921
          0.58477959694433
         0.642605082618587
         0.672455082373517
         0.770058516246579
         0.531621956897212
         0.598042502510935
         0.549242478018996
         0.499248006844368
         0.688115565261711
          0.70782328916647
         0.877347919827201
         0.973810982577376
         0.713642973477121
         0.382557057525986
         0.442270606309407
         0.505781084771684
         0.656287312417618
         0.686513878706521
         0.498166414821171
         0.280236536818038
         0.486286909142734
         0.581989573689924
         0.696069366204355
         0.720154662809875
         0.530492933260462
         0.654717544099043
         0.765936173903981
         0.633673990095943
         0.479299637361805
         0.187038265196122
         0.269794803673975
         0.310485505222104
         0.599339676055436
         0.476930325882392
         0.181151025651701
         0.229568839249168
        0.0188325035544068
        -0.189455192471456
        -0.212605128377348
         -0.15014067830468
       -0.0336577130967441
        0.0514887921249567
         0.053228491092284
        0.0332103482770663
        -0.406507555328616
        -0.582315492386584
        -0.659388184655739
        -0.671713244465067
        -0.537376710355801
         -0.36548370789771
       -0.0643230460617019
       -0.0233354128271799
          0.05580991635982
         0.238012515056255
         0.245594351220149
           0.2191455578117
       -0.0197107161589685
        -0.424464143995792
        -0.786372453667994
        -0.582815070942885
        -0.622116741266112
        -0.486861598066653
        -0.416321339427441
        -0.646952462183336
        -0.962273010388643
         -1.01934861767924
         -0.87060397170076
        -0.706320725501911
        -0.799763474439942
        -0.971126181649424
         -1.11180526277838
         -1.29821897430645
         -1.38322932281228
         -1.45784607567914
        -0.956015553089443
        -0.821105092225977
        -0.810325523925911
        -0.533858394647012
        -0.548564703054595
        -0.691279435715629
        -0.792458141424291
         -0.66193144420653
        -0.676905198765979
        -0.660417957175596
        -0.698810518408209
        -0.834344444357768
        -0.840914358267497
        -0.558337807464042
        -0.566192581650995
        -0.366667080859571
         -0.55664188396625
        -0.451725283936582
        -0.376214250990401
        -0.415581037171151
        -0.114665886907716
        -0.244674408357653
        -0.319907222632949
        -0.528494929796082
        -0.379577047512186
        -0.341521227562694
        -0.317684404065474
        -0.433229869415044
        -0.349451995004898
        -0.357394230340816
        -0.406140125791467
        -0.412597985269201
        -0.212673395356447
        -0.416799144117476
        -0.310451774104081
        -0.141555188356577
        -0.282075722962972
        -0.331897476791028
        -0.330285983330583
        -0.216126594934664
        -0.268480717236557
        -0.239188643157121
        -0.382043544588029
        -0.686484451164759
         -0.92992457182379
         -1.09284723922386
         -1.20707123804017
         -1.20850246087788
         -1.32172139327092
         -1.39357314460692
         -1.28637749337922
         -1.17922463841005
        -0.615745337206391
        -0.531615719384064
        -0.474249001646882
        -0.233256135586913
        -0.281838991844936
         -0.37181611079717
        -0.159055277237456
       -0.0555226182923576
        -0.134191473353852
        -0.063776960542711
      -0.00358044226371135
        -0.148623937012204
      -0.00409285130994874
         0.190026885110925
         0.307024879275232
        -0.149779708832043
        -0.413103578283412
        -0.564390514946922
        -0.900448372704233
         -1.05857744642572
         -1.50338937304977
          -1.7522086585802
         -1.62405882386729
         -1.64124027965788
         -1.75489451605624
        -0.792918711121601
        -0.882727848463546
        -0.834094511163087
        -0.907514653765205
        -0.558017013232501
        -0.782864600244196
        -0.573247025734148
        -0.390797285811061
        -0.497200152407146
        -0.418503224978011
         -0.20248887838801
       -0.0227386635515217
         0.162148523724596
        -0.159331336451601
        -0.734202506900672
         -1.21744905510174
         -1.46108866899293
          -1.6252803935141
         -1.62794469638094
          -1.4449628072495
         -1.32690041982703
        -0.651598545730181
        -0.448124068332859
        -0.353211354390766
        -0.121236570591606
        -0.313239623883831
        -0.690327307487621
        -0.832932446036196
        -0.768841684801373
        -0.814263012011196
        -0.658209996094911
        -0.444346467938672
        -0.240662736578329
        -0.236860410154648
       -0.0926035478515388
         0.283519126955412
         0.240324308561412
         0.151411788036526
         0.632891557103207
          0.52744533065902
          0.96521134417722
         0.536874860548508
         0.997806071347995
          0.82491614000466
         0.344013851005357
         0.111667051228963
         0.494163533356769
        -0.175531480826109
        -0.278382536119068
         -1.16553879793157
         -1.48752361963565
         -1.59188506808354
         -1.18513597908245
          -1.3446232237972
         -0.92337831322827
         -0.66042084061479
        -0.331739252425507
        -0.525045318656524
         0.130339588433159
         0.111319264234254
        0.0776823980438621
         0.337716118770444
         0.520126384496848
         0.783990650691848
         0.412971054678934
         0.556127917322996
         0.737204050893226
         0.542161859691845
         0.426316618209881
         0.146335220231876
         0.473278031215429
         0.506970690352929
          0.88450066944111
         0.942773174491336
          1.38751224031343
          1.22966631742089
         0.765602992551592
         0.348451495091638
         0.581792835916119
         0.524910153775693
         0.374125306985718
         0.732052192413093
         0.506148299368547
         0.614417105658717
         0.277206970603672
         0.411929502168988
         0.107708414150053
        -0.130900259517134
        -0.289064240665752
        -0.607213611871217
        -0.692537730712957
        -0.957065143453534
        -0.579477459391185
        -0.701631192108792
        -0.117458232190288
        -0.521400670692984
        -0.659347139768485
        -0.767788633740906
        -0.416758394251772
        0.0624238066173888
         0.140727446208118
         0.288355029382259
           4.6343290981805
       -0.0192708437150628
        -0.347440815893435
        -0.383466500063491
        -0.295064254100751
        -0.541333755778297
         -0.12621841786391
        0.0369187089560938
         0.532321374257563
         0.832653442537818
         0.927419247874255
         0.868973692733817
          1.06733791625744
         0.848835408102374
          1.02642526333086
             1.07392309533
          1.54228394047803
          1.26539770435767
          1.30954193211078
          1.11207204648552
         0.983877357792664
          0.89019569854878
         0.573516396288738
         0.336216371464943
          0.14151989486524
         0.647779360620206
         0.714395249597288
          1.14971528947417
            1.211430469755
          1.01051622216107
          1.46951669813032
         0.925239070156636
         0.337191211052698
        -0.263891752750581
        -0.419416097374679
        -0.397950468569761
        -0.147501025683852
        -0.406080611394799
        -0.704896666429661
          -0.2866884256064
        0.0294361357433957
        -0.141939560897953
        -0.237243955931604
        -0.505079038421769
        -0.144505314868255
        -0.456779485249456
         -1.00033110168467
          -1.2477712271025
          -1.5482380865873
         -1.47031829992223
         -1.54068990229931
         -1.38162745416227
         -1.69246507867959
         -1.46270642812524
         -1.53830338318051
         -1.67314812687187
          -2.0651721431872
         -2.30346001343815
         -2.18912802158005
         -2.00762473185063
         -2.11609001258032
         -2.35386384537074
          -2.3247499090526
         -2.35738507016791
         -2.20885580886002
         -1.85109919500084
         -1.80180232082691
         -1.52536288578304
          -1.9062126428197
         -1.95555906722522
         -2.13472558550895
         -1.80002500247947
         -1.58904961317154
         -1.44027137260761
         -1.35008880808292
         -1.28821860315949
         -1.21455534386531
         -1.33952764203761
         -1.41285873596139
         -1.62899716647702
         -1.51169123323253
          -1.6438054716733
         -1.62950256407294
         -1.87139635066947
         -1.54351478338954
         -1.32415202816277
         -1.13155648496061
         -1.48677432743308
         -1.23435870265513
         -1.44648455942917
         -1.25277322697333
         -1.51173325577044
         -1.29830078952867
          -1.3801251479472
         -1.50306516351623
         -1.99133687131601
           -1.866012749685
         -2.17794275272612
          -2.6051657640127
         -1.60698927961724
          -1.7827603026731
         -1.68692642467626
         -1.45238870976586
         -1.01679393725999
         -1.25589760930643
         -1.38811679086751
         -1.57609450312788
         -1.09816434351485
         -1.20170991895118
         -1.00397334389655
        -0.606195923121433
        -0.818887951829225
        -0.291175051938325
        -0.155894381216385
        0.0460722736698642
       -0.0861421367887658
        -0.044211481535541
         0.327433838704621
         0.258578184211572
         0.395310652623394
         0.408346086800634
         0.372827557736073
         0.451953089097614
         0.767165783517711
          0.87055961117666
         0.917210359048568
         0.574680005774539
         0.620225167754256
         0.433237117288272
         0.136565355198996
         -0.46863736092368
        -0.990854899863834
         -1.61886257635885
         -1.83748717556483
         -1.31609162372817
        -0.889896947222638
        -0.513451715459155
        -0.411855170191188
        -0.279048140415483
       -0.0966199285071383
        -0.448922393952216
        -0.483065722812299
        -0.270487628821058
        -0.269071509805855
        -0.337370730664944
        -0.330906513811911
        -0.581657544052035
        -0.978967377040675
         -1.16689457784629
         -1.14718632127682
          -1.1125641916429
         -1.18810773447201
         -1.31397064908211
         -1.45163188479833
        -0.518964834901567
        -0.566627913857815
        -0.437795659835089
        -0.366449835933167
         -0.34723251841217
        -0.239118466811917
       -0.0517373550019187
        -0.118449927907804
        -0.205742719595833
       -0.0640509920493884
        0.0588761392220647
        0.0105347114307506
         0.212190630893005
         0.335722410242738
         0.273702029421841
         0.457247273082231
         0.687396709946725
         0.541276710219748
         0.837678568422888
          0.99983111635845
           1.0565831110267
         0.977000239428747
         0.828424435217272
         0.533638372811012
         0.454045331503906
        0.0824205543257364
        -0.108565943812991
          -0.1096404355619
         0.085927006936501
        0.0669993950309333
        -0.164505700799879
        -0.464045222135084
        -0.672023491534986
        -0.790066117488692
        -0.486038986057366
        -0.755363768066417
        -0.897456212962709
         -1.06343563275378
         -1.12088087460654
         -1.10356427251897
         -1.24680772878816
         -1.16099066087763
         -1.26135753382577
        -0.125387023082837
        -0.188101042604828
         0.020859840131024
        0.0832541289338735
        0.0425301798280202
        -0.109508706757595
         0.116151672980195
         0.349003185898624
         -1.07358416821918
         -3.70180494730754
         -5.72889957973406
         -4.31982430929922
          -2.0246304334207
         0.769036867760988
         0.576515668626413
         0.229244911737382
         0.128821973098184
        -0.387748560967381
        -0.616483674482794
         -0.82826276246773
        -0.805517086173325
         -1.08981405550217
         -1.01046161511026
        -0.633645520510115
        -0.629259297140678
        -0.497002382342131
        -0.360711582742212
        -0.258601717392693
        -0.385542832762695
        -0.682321814212756
        -0.829029359814726
         -0.98989886130731
         -1.12495796616133
         -1.14611339667714
          -1.1238259172345
         -1.11828167644563
         -1.20491409798883
         -1.19832616944218
         -1.30131603742925
         -1.27331354779639
         -0.43732383155178
        -0.569100409280267
        -0.835069942796821
         -0.85309112011052
        -0.785268654400141
        -0.901865709374079
         -1.17203402733224
         -1.09403834701061
        -0.728236402386983
        -0.660498804868638
        -0.304687136835327
        -0.246739261315227
        0.0137914086216853
         0.276731475571736
         0.277541070116612
         0.353867257953638
         0.654395862778472
         0.916951761974289
         0.304760540586855
         0.582312296078342
         0.169125533157342
          3.11784349177232
          7.10698010566898
          7.45781202684924
          7.52143652504479
          5.44404453697148
          4.97980966837089
          5.67292695247137
          5.15025363769153
          2.04943917423265
          2.37185481404998
        -0.696934034948299
        -0.331494123146967
        -0.405162905817051
       -0.0788904293443551
         -1.09073138362858
         -0.55687892200315
        -0.757117260869549
        -0.970966039444207
        -0.136903609911784
         -1.15368580948839
         -1.28738483200469
         -1.58739461717143
         -2.22395380936658
         -1.22007697274967
         -1.20301996525632
         -1.70125654438829
         -1.42031714039871
         -1.59141510651526
         -1.79625787563683
          -1.4453725237382
         -1.45255074618407
         -1.40594318700498
         -1.71453339696447
         -1.35141461726843
         -0.97386609389568
         -1.33961176358225
         -1.45372457193541
         -1.39574687315229
         -1.47058154677005
         -1.56281958461157
          -1.7708730339272
         -1.59139110127694
         -1.69672903860305
         -1.66525438295396
         -1.81189515228441
         -2.08808157133863
         -1.91819004923799
         -1.11585777566653
          -1.1039225208291
         -1.11747137037383
         -1.24544430385806
         -1.34200319765374
          3.17282003962373
          10.0089462151015
          10.2266037948027
          9.42091758757851
          8.77586627052504
          7.67357698401216
          6.60070948435207
          1.65246555848459
        -0.819330984956366
        -0.698535744232899
          1.70630323775241
          3.52998797682456
          5.04807938950886
          6.97203746504162
          7.29905290475816
          7.50464435274093
          7.35975548118236
          7.32416381618827
          7.05814466002003
          6.80905252134691
          6.12911710913835
          6.11760166329147
          8.73144064276357
          9.70460374381699
          10.0988474922915
          10.9452637902776
           11.709880134218
          11.7805513637968
          11.9931765099473
          10.3228523135593
           8.3547007587848
          8.31930470794353
          7.56273682673186
          6.44273992322006
          5.58017099796923
          4.82074004581858
          4.55810027199693
          4.84233126372835
          4.08036300623863
           3.7181147871831
          3.87586868395802
          3.08944632964619
          2.25959953546101
          2.12048834122254
          3.72879084222869
          2.58910237410622
           1.3182365437988
         0.248908723645428
         -0.55177874327849
        -0.648584786660706
        -0.844647276787384
         -1.60084611939875
         -1.85780156596776
         -1.88421653343401
         -1.35392283655027
        -0.669116796694652
        -0.785696642781659
         -0.51108716929761
         -1.31330535437868
         -1.18392999481561
        -0.910440288280554
          -1.7515040909328
         -2.23782271637423
         -1.46857917485535
         -1.42656388931769
         -1.71580543241467
        -0.815359809785164
        -0.550404226438346
         -1.20905685724316
         -1.01405695946234
         -1.73985530137089
         -1.92974682410579
         -2.31479065409087
         -2.03400110469909
         -1.92996419139696
         -1.68961081790619
         -1.86707539397864
         -1.64145500788536
         -1.57953119015667
          -1.5423032405029
         -2.24762776807637
         -2.57428163292825
         -3.13391314674357
         -3.22639043927371
         -2.69744326938547
         -1.69595611647998
         -2.38951013397269
         -1.82041620905663
         -1.85664956068609
         -2.04825829855633
         -1.79307576748953
         -1.26808948229238
         -1.77871610009235
         -1.34585652371881
         -1.46876635326227
        -0.729100114688521
        -0.651369614310028
        -0.338199864618559
       -0.0941854555361488
         0.173484950645104
        -0.104594297502956
        -0.239532872038936
        -0.291206423581471
        0.0234535909750093
        0.0513351570547655
       -0.0105197637439147
        0.0777991731783914
        0.0190951023914323
        0.0459047739530121
        -0.149851380003653
        -0.345146692877009
        -0.504987545702008
        -0.690479862881531
        -0.751883961735544
        -0.428009506446145
         -0.46049705973401
        -0.401317244486336
        0.0647576321783987
        -0.150952850483321
        -0.416342973501145
        -0.525337276079171
        -0.493432994670954
        -0.800717011395903
        -0.443025232611802
         0.111730472173477
         0.168414134036212
         0.173014745204426
         0.186785375046355
       -0.0628294642381917
       -0.0732963660013581
          -0.3207290362771
        -0.293486979996445
        -0.237630237037578
        -0.466920812411203
        -0.550484895789765
        -0.618070988005371
        -0.818520044275388
        -0.499649869590428
        -0.888587920900534
        -0.454501079361705
       -0.0969630438948457
        0.0350408425592548
        -0.198165151240929
        -0.267206167563415
        -0.484919957891577
        -0.421066214831498
        -0.080889523245645
       -0.0549907578244984
        -0.450988044423653
        -0.493473911512396
        -0.418977322280611
        -0.379226736085727
        -0.230052349319379
       -0.0284107876561421
        -0.111324456356058
        -0.259093970935666
         -0.27400045242841
        -0.398815680291904
         -0.71165981260495
         -1.09880565469729
        -0.795348039365365
        -0.408385465706047
        0.0770159924333171
         0.155778613129272
         0.288852043855172
         0.414176505324576
         0.514531288879425
         0.251224912045544
         0.156667989058533
         0.200798571744798
        0.0871394175402003
        -0.351024101122746
        -0.695587540093996
         -1.16397363831736
        -0.940711834610028
        -0.550865416838249
        -0.372547026068176
       -0.0752456373953976
         0.130404604057134
         0.228077470886049
         0.321566021401807
         0.420495188913264
         0.390888600362771
         0.313402464514525
        0.0608786908634045
        0.0855638626898383
         0.134000805005684
         0.182535404906972
         0.116403855340238
         -0.69993109812971
        -0.423857198963191
      0.000388054984370001
        -0.326858004937947
        -0.917977892072102
        -0.923317318857315
        -0.891572910688382
        -0.889102414631424
        -0.312486879886876
        -0.417761290694273
        -0.145431258717849
       -0.0166744886780918
       -0.0975374405823288
        -0.107289773267738
        -0.230070081027861
        -0.182233568864689
        -0.498472328706015
        -0.628763357017334
        -0.705219030657375
        -0.789388597568248
         -1.25691207684891
         -1.48392923658096
         -1.45785383990145
        -0.367526305643338
        -0.296273773520085
         -0.33091659609768
        -0.136191590532945
       -0.0109782619840928
        -0.062405108540986
       -0.0297020503566898
      -0.00341248128960103
        -0.233888799772302
        -0.365998727031283
        -0.330514590492953
        -0.264898310010892
        -0.367654713123414
        -0.434392653359552
        -0.498630656360348
        -0.442813336610996
        -0.104901967089276
        -0.156362015867884
        -0.218503474072563
        -0.490014924281027
        -0.492420084645389
         -0.50419514302007
        -0.546988773322255
        -0.464229030295428
        -0.365697839311707
        -0.206213004850525
       -0.0826193827463442
         0.132863926378434
         0.410789156993872
        -0.281976588104897
         -1.00938951055737
         -1.34479018584631
         -1.28146384380403
        -0.654104088808012
        -0.184052544314213
       0.00662000339535496
         0.217751989315829
          0.31650512781809
         0.474080330888498
         0.406480984937659
         0.177053720364768
        0.0511042714511092
         0.132762132861799
         0.184432135585567
         0.127195958746213
          0.10048325932982
        -0.100137195384377
       -0.0687388248325078
      -0.00594092693354753
];

params = [
         -8.32774123037147          8483.79355263153
         -7.95224052432009          8105.69201370344
]